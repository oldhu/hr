$(document).ready(function() {
    globalTable = $('#table').dataTable({
        "bProcessing": true,
        "bServerSide": true,
        "sAjaxSource": "<%= humen_path %>.json",
        "bPaginate": false,
        "bLengthChange": false,
        "bFilter": false,
        "bSort": false,
        "bInfo": false,
        "bAutoWidth": false
    });

    $('#new_human_link').click(function() {
		openDialog("<%= new_human_path %>?dept_id=" + getTreeSelectionKey(), 380, 470, "New Human");
    });

    $('#edit_human_link').click(function() {
		openDialog("<%= humen_path %>/" + getTableSelectionKey() + "/edit", 380, 470, "Edit Human");
    });

	$("#table tbody").click(function(event) {
		$(globalTable.fnSettings().aoData).each(function (){
			$(this.nTr).removeClass('row_selected');
		});
		$(event.target.parentNode).addClass('row_selected');
		
		// update delete link
		$("#delete_human_link").attr("href", "<%= humen_path %>/" + getTableSelectionKey());
	});
});

function onTreeNodeActivate(node) {
	var table = getTable();
	table.fnSettings().sAjaxSource = "<%= humen_path %>.json?dept_id=" + node.data.key;
	table.fnDraw();
};